import React, { useState, useEffect } from 'react';
import { 
  Plane, 
  Train, 
  Car, 
  MapPin, 
  Utensils, 
  Camera, 
  Info, 
  Phone, 
  CreditCard, 
  Sun, 
  CloudRain, 
  Cloud, 
  ChevronRight, 
  X,
  Navigation,
  Calendar,
  Briefcase,
  Home
} from 'lucide-react';

// --- Types & Data Structures ---

type ItineraryItem = {
  id: string;
  time: string;
  title: string;
  type: 'transport' | 'spot' | 'food' | 'hotel' | 'flight';
  location: string;
  description?: string;
  tips?: string[]; // ÂøÖÂêÉ„ÄÅÂøÖË≤∑„ÄÅÊîªÁï•
  bookingCode?: string; // È†êÁ¥Ñ‰ª£Ëôü/ÈóúÈçµÂ≠ó
  bookingImage?: string; // Ê®°Êì¨Á•®Âà∏ÂúñÁâá
  lat?: number; // For navigation
  lng?: number; // For navigation
};

type DayPlan = {
  date: string;
  dayOfWeek: string;
  weather: { temp: string; icon: 'sun' | 'rain' | 'cloud' };
  items: ItineraryItem[];
};

// --- Mock Data (Based on user's PDF + Suggestion) ---

const itineraryData: DayPlan[] = [
  {
    date: '12/3',
    dayOfWeek: 'ÈÄ±‰∏â',
    weather: { temp: '14¬∞C', icon: 'cloud' },
    items: [
      {
        id: '1-1',
        time: '07:30',
        title: 'ÊòüÂÆáËà™Á©∫ JX846',
        type: 'flight',
        location: 'Ê°ÉÂúíÊ©üÂ†¥ (TPE) T1',
        description: 'È£õÂæÄÁÜäÊú¨ (KMJ)ÔºåÈ†êË®à 10:30 ÊäµÈÅî„ÄÇ',
        bookingCode: 'REF: KYU-1203-STAR',
        tips: ['üí° Ë®òÂæóÊèêÂâç2Â∞èÊôÇÊäµÈÅîÊ©üÂ†¥', 'üí° È£õÊ©üÈ§êÊé®Ëñ¶ËÉ°ÂêåÁáíËÇâ'],
      },
      {
        id: '1-2',
        time: '12:00',
        title: 'Ê©üÂ†¥Â∑¥Â£´ÁßªÂãï',
        type: 'transport',
        location: 'ÁÜäÊú¨Ê©üÂ†¥ ‚Üí ÁÜäÊú¨Á´ô',
        description: 'Êê≠‰πòÊ©üÂ†¥Âà©Êú®Ê¥•Â∑¥Â£´ÂâçÂæÄÂ∏ÇÂçÄ„ÄÇ',
        tips: ['üí° ÂèØ‰ΩøÁî® IC Âç° (Suica/ICOCA)'],
      },
      {
        id: '1-3',
        time: '13:00',
        title: 'Êñ∞ÂππÁ∑ö ÁëûÁ©ó/Ê´ªËä±Ëôü',
        type: 'transport',
        location: 'ÁÜäÊú¨Á´ô ‚Üí ÂçöÂ§öÁ´ô',
        description: 'ËΩâ‰πòÊñ∞ÂππÁ∑öÂâçÂæÄÁ¶èÂ≤°ÔºåËªäÁ®ãÁ¥Ñ 32 ÂàÜÈêò„ÄÇ',
        tips: ['‚ö†Ô∏è ÂãôÂøÖÈ†êÁ¥Ñ„ÄåÁâπÂ§ßË°åÊùéÂ∏≠„Äç', 'üí° Êé®Ëñ¶Âú®ËªäÁ´ôË≤∑ÁÜäÊú¨ÁÜä‰æøÁï∂'],
        bookingCode: 'JR-RES-9988'
      },
      {
        id: '1-4',
        time: '14:30',
        title: 'KOKO HOTEL Á¶èÂ≤°Â§©Á•û',
        type: 'hotel',
        location: 'Á¶èÂ≤°Á∏£Á¶èÂ≤°Â∏Ç‰∏≠Â§ÆÂçÄ‰ªäÊ≥â1-22-14',
        description: 'Check-in ÂØÑÊîæË°åÊùé„ÄÇ‰ΩçÊñºÂ§©Á•ûÂçóÁ´ôÈôÑËøëÔºå‰∫§ÈÄöÊñπ‰æø„ÄÇ',
        bookingCode: 'AGODA-55214'
      },
      {
        id: '1-5',
        time: '15:30',
        title: 'Ê´õÁî∞Á•ûÁ§æ',
        type: 'spot',
        location: 'Á¶èÂ≤°Â∏ÇÂçöÂ§öÂçÄ‰∏äÂ∑ùÁ´ØÁî∫Ôºë‚àí41',
        description: 'ÂçöÂ§öÁ∏ΩÈéÆÂÆàÔºåÂøÖÁúãÂ∑®Â§ßÁöÑË£ùÈ£æÂ±±Á¨†„ÄÇ',
        tips: ['üí° ÂøÖË≤∑ÔºöÂçöÂ§öÁπîÂæ°ÂÆà', 'üí° ÂèÉÊãúÂæåÂèØÈÄõÊóÅÈÇäÁöÑÂ∑ùÁ´ØÈÄöÂïÜÂ∫óË°ó']
      },
      {
        id: '1-6',
        time: '18:30',
        title: 'ÂçöÂ§öÊë©ÊªãÈçã (ÊôöÈ§ê)',
        type: 'food',
        location: 'ÂçöÂ§öÊë©ÊªãÈçã ÂâçÁî∞Â±ã/Â§ßÂ±±',
        description: 'Á¶èÂ≤°ÂøÖÂêÉÁâõËÖ∏ÈçãÔºåÊøÉÈÉÅÂë≥ÂôåÂè£Âë≥„ÄÇ',
        tips: ['üî• ÂøÖÈªûÔºöÂë≥ÂôåÂè£Âë≥ÁâõËÖ∏Èçã', 'üî• Êî∂Â∞æÂøÖÈªûÔºöÂº∑Ê£íÈ∫µ']
      }
    ]
  },
  {
    date: '12/4',
    dayOfWeek: 'ÈÄ±Âõõ',
    weather: { temp: '12¬∞C', icon: 'sun' },
    items: [
      {
        id: '2-1',
        time: '09:00',
        title: 'ÁßªÂãïÔºöË•øÈêµÈõªËªä',
        type: 'transport',
        location: 'Ë•øÈêµÁ¶èÂ≤°(Â§©Á•û) ‚Üí Â§™ÂÆ∞Â∫ú',
        description: 'Êê≠‰πòÊóÖ‰∫∫ËôüËßÄÂÖâÂàóËªä(Â¶ÇÊúâÈÅáÂà∞)„ÄÇ',
      },
      {
        id: '2-2',
        time: '10:00',
        title: 'Â§™ÂÆ∞Â∫úÂ§©ÊªøÂÆÆ',
        type: 'spot',
        location: 'Â§™ÂÆ∞Â∫úÂ§©ÊªøÂÆÆ',
        description: 'Â≠∏Âïè‰πãÁ•ûÔºåË≥ûÊ¢ÖÂêçÊâÄÔºàÈõñÁÑ∂ÁèæÂú®ÊòØÂÜ¨Â§©Ôºâ„ÄÇ',
        tips: ['ü•Ø ÂøÖÂêÉÔºöÊ¢ÖÊûùÈ§Ö (Êé®Ëñ¶Âä†Ëñ©Ë´æ‰∫û Kasanoya)', 'üí° Êë∏Âæ°Á•ûÁâõÁöÑÈ†≠ÊúÉËÆäËÅ∞Êòé']
      },
      {
        id: '2-3',
        time: '12:00',
        title: '‰∏ÄËò≠ÊãâÈ∫µ Â§™ÂÆ∞Â∫úÂèÉÈÅìÂ∫ó',
        type: 'food',
        location: 'Â§™ÂÆ∞Â∫úÂèÉÈÅì',
        description: 'ÂÖ®ÁêÉÂîØ‰∏ÄÁöÑ‰∫îËßíÂΩ¢Á¢óÔºåË±°Âæµ„ÄåÂêàÊ†º„Äç„ÄÇ',
        tips: ['üî• È∫µÊ¢ùÊØî‰∏ÄËà¨ÁöÑÈï∑(Ë±°ÂæµÈï∑Â£Ω/Èï∑‰πÖ)', 'üí° ÊπØÂñùÂÆåÁ¢óÂ∫ïÊúâ„ÄåÊ±∫ÂÆö„Äç‰∫åÂ≠ó']
      },
      {
        id: '2-4',
        time: '14:00',
        title: 'Á´àÈñÄÁ•ûÁ§æ',
        type: 'spot',
        location: 'Á´àÈñÄÁ•ûÁ§æ',
        description: 'È¨ºÊªÖ‰πãÂàÉËÅñÂú∞ÔºåÁµêÁ∑£Á•ûÁ§æ„ÄÇÈúÄÊê≠‰πòÁ§æÂçÄÂ∑¥Â£´„ÄåÊë©Ë®∂ËÄ∂„Äç„ÄÇ',
        tips: ['üí° ÈÄôË£°ÁöÑÂæ°ÂÆàË®≠Ë®àÈùûÂ∏∏ÊôÇÂ∞öÔºåÈÅ©ÂêàÁï∂‰º¥ÊâãÁ¶Æ']
      }
    ]
  },
  {
    date: '12/5',
    dayOfWeek: 'ÈÄ±‰∫î',
    weather: { temp: '8¬∞C', icon: 'cloud' },
    items: [
      {
        id: '3-1',
        time: '09:00',
        title: 'ÁßüËªäÂèñËªä',
        type: 'transport',
        location: 'TOYOTA Rent a Car Ëó•Èô¢Á´ôÂâçÂ∫ó',
        description: 'Ëæ¶ÁêÜÁßüËªäÊâãÁ∫åÔºåÁ¢∫Ë™ç ETC Âç°„ÄÇ',
        bookingCode: 'RES: TOYOTA-8821',
        tips: ['‚ö†Ô∏è Ê™¢Êü•ËªäË∫´ÂàÆÁóï', '‚ö†Ô∏è Ë®≠ÂÆöÂ∞éËà™Ëá≥ÈòøËòá']
      },
      {
        id: '3-2',
        time: '12:30',
        title: 'ÈòøËòáËµ§Áâõ‰∏º (ÂçàÈ§ê)',
        type: 'food',
        location: 'ÈòøËòá ImakinÈ£üÂ†Ç (ÊàñÂë®ÈÇä)',
        description: 'ÈòøËòáÂøÖÂêÉÁæéÈ£üÔºåÂçäÁÜüÁ¥ÖÁâõËÇâÈã™Êªø‰∏ºÈ£Ø„ÄÇ',
        tips: ['üî• ÂøÖÂêÉÔºöËµ§Áâõ‰∏º', 'üí° Â¶ÇÊûúImakinÊéíÂ§™‰πÖÔºåÂèØÂéª Meshi-no-sato']
      },
      {
        id: '3-3',
        time: '14:00',
        title: 'ËçâÂçÉÈáå‰πãÊø± & ÈòøËòáÁÅ´Âè£',
        type: 'spot',
        location: 'ÈòøËòáÂ±±ËçâÂçÉÈáå',
        description: '‰∏ÄÊúõÁÑ°ÈöõÁöÑÂ§ßËçâÂéüËàáÂÜíÁÖôÁöÑÁÅ´Â±±Âè£„ÄÇ',
        tips: ['üí° Â±±‰∏äÈ¢®Â§ßÔºåË´ãÂ∏∂ÂéöÂ§ñÂ•ó', 'üí° ÂøÖË≤∑ÔºöÈòøËòáÁâõÂ•∂ÂÜ∞Ê∑áÊ∑ã']
      },
      {
        id: '3-4',
        time: '15:30',
        title: 'Â§ßËßÄÂ≥∞Â±ïÊúõÊâÄ',
        type: 'spot',
        location: 'Â§ßËßÄÂ≥∞',
        description: '360Â∫¶Áú∫ÊúõÈòøËòá‰∫îÂ≤≥(Ê∂ÖÊßÉÂÉè)ÁöÑÊúÄ‰Ω≥Âú∞Èªû„ÄÇ',
      },
      {
        id: '3-5',
        time: '16:30',
        title: 'ÈªëÂ∑ùÊ∫´Ê≥â Check-in',
        type: 'hotel',
        location: 'ÈªíÂ∑ùÊ∏©Ê≥â „ÇÑ„Åæ„Å≥„ÅìÊóÖÈ§®',
        description: 'ÂÖ•‰ΩèÊó•ÂºèÊ∫´Ê≥âÊóÖÈ§®Ôºå‰∫´Âèó‰ªô‰∫∫È¢®ÂëÇ„ÄÇ',
        bookingCode: 'JAPANICAN-9921',
        tips: ['üí° Ë≥ºË≤∑„ÄåÂÖ•ÊπØÊâãÂΩ¢„ÄçÂèØÊ≥°‰∏âÈñì‰∏çÂêåÊ∫´Ê≥â', 'üí° ÊôöÈ§êÂâçÂÖàÂéªÊ≥°ÊπØ']
      }
    ]
  },
  {
    date: '12/6',
    dayOfWeek: 'ÈÄ±ÂÖ≠',
    weather: { temp: '5¬∞C', icon: 'cloud' },
    items: [
      {
        id: '4-1',
        time: '10:00',
        title: '‰∏äËâ≤Ë¶ãÁÜäÈáéÂ∫ßÁ•ûÁ§æ',
        type: 'spot',
        location: '‰∏äËâ≤Ë¶ãÁÜäÈáéÂ∫ßÁ•ûÁ§æ',
        description: 'ÈÄöÂæÄÁï∞‰∏ñÁïåÁöÑÂÖ•Âè£ÔºåÂÖÖÊªøÈùíËãîÁöÑÁ•ûÁßòÈöéÊ¢Ø„ÄÇ',
        tips: ['üì∏ ÂøÖÊãçÔºöÂèÉÈÅìÈöéÊ¢ØËàáÁ©øÈÄèÂ≤©Áü≥ÁöÑÈ¢®Á©¥']
      },
      {
        id: '4-2',
        time: '12:00',
        title: 'È´òÊ£ÆÁî∞Ê®Ç‰øùÂ≠òÊúÉ (ÂçàÈ§ê)',
        type: 'food',
        location: 'È´òÊ£ÆÁî∞Ê•Ω‰øùÂ≠ò‰ºö',
        description: 'ÂúçËëóÂú∞ÁàêÂêÉÂë≥ÂôåÁÉ§‰∏≤ÔºåÈùûÂ∏∏ÊúâÊ∞£Ê∞õ„ÄÇ',
      },
      {
        id: '4-3',
        time: '13:30',
        title: 'Â§©Â≤©Êà∂Á•ûÁ§æ & Â§©ÂÆâÊ≤≥Âéü',
        type: 'spot',
        location: 'Â§©Â≤©Êà∏Á•ûÁ§æ Ë•øÊú¨ÂÆÆ',
        description: 'Êó•Êú¨Á•ûË©±Ëµ∑Ê∫êÂú∞ÔºåÂú®Ê≠§Â†ÜÁü≥È†≠Ë®±È°ò„ÄÇ',
      },
      {
        id: '4-4',
        time: '15:00',
        title: 'Solest Takachiho Hotel',
        type: 'hotel',
        location: 'Solest Takachiho Hotel',
        description: 'Check-in ‰ºëÊÅØ„ÄÇ',
        bookingCode: 'BOOKING-1122'
      },
      {
        id: '4-5',
        time: '17:00',
        title: 'È´òÂçÉÁ©óÁáíËÇâ„ÄåÂíå„Äç',
        type: 'food',
        location: 'È´òÂçÉÁ©ÇÁâõ„É¨„Çπ„Éà„É©„É≥Âíå',
        description: 'È†ÇÁ¥öÈ´òÂçÉÁ©óÁâõÁáíËÇâ„ÄÇ',
        tips: ['‚ö†Ô∏è ÈúÄÊèêÂâçÈ†êÁ¥Ñ', 'üî• ÂøÖÈªûÔºöÈ´òÂçÉÁ©óÁâõÈáåËÑä'],
        bookingCode: 'TEL-RES-NAME-CHEN'
      },
      {
        id: '4-6',
        time: '20:00',
        title: 'È´òÂçÉÁ©óÁ•ûÊ®Ç',
        type: 'spot',
        location: 'È´òÂçÉÁ©óÁ•ûÁ§æ',
        description: 'Â§úÁ•ûÊ®ÇË°®ÊºîÔºåÈ´îÈ©óÊó•Êú¨ÂÇ≥Áµ±ÊñáÂåñ„ÄÇ',
        tips: ['üí° 19:00 ÈñãÊîæÂÖ•Â†¥ÔºåÂª∫Ë≠∞ÊèêÊó©Âéª‰Ωî‰Ωç']
      }
    ]
  },
  {
    date: '12/7',
    dayOfWeek: 'ÈÄ±Êó•',
    weather: { temp: '9¬∞C', icon: 'sun' },
    items: [
      {
        id: '5-1',
        time: '09:00',
        title: 'È´òÂçÉÁ©óÂ≥Ω ÂàíËàπ',
        type: 'spot',
        location: 'È´òÂçÉÁ©óÂ≥ΩÊ∑°Ê∞¥È≠öÊ∞¥ÊóèÈ§®(‰πòËàπËôï)',
        description: 'Âú®Â≥ΩË∞∑‰∏≠ÂàíËàπÔºåËøëË∑ùÈõ¢ÁúãÁúüÂêç‰∫ïÁÄëÂ∏É„ÄÇ',
        tips: ['‚ö†Ô∏è ÂãôÂøÖ‰∫ãÂÖà‰∏äÁ∂≤È†êÁ¥Ñ', 'üì∏ ÂøÖÊãçÔºöÁÄëÂ∏ÉËàáËàπÁöÑÂêàÂΩ±'],
        bookingCode: 'BOAT-RES-3344'
      },
      {
        id: '5-2',
        time: '12:00',
        title: 'ÊµÅÊ∞¥Á¥†È∫µ (ÂçàÈ§ê)',
        type: 'food',
        location: 'ÂçÉÁ©ó‰πãÂÆ∂',
        description: 'È´îÈ©óÁ´πÁÆ°ÊµÅÊ∞¥Á¥†È∫µ„ÄÇ',
      },
      {
        id: '5-3',
        time: '15:00',
        title: 'ÁÜäÊú¨ÈÇÑËªä',
        type: 'transport',
        location: 'TOYOTA Rent a Car ÁÜäÊú¨Á´ôÂâçÂ∫ó',
        description: 'Âä†ÊªøÊ≤πÂæåÈÇÑËªä„ÄÇ',
      },
      {
        id: '5-4',
        time: '15:30',
        title: 'CANDEN HOTEL ÁÜäÊú¨',
        type: 'hotel',
        location: 'CANDEO HOTELS ÁÜäÊú¨Êñ∞Â∏ÇË°ó',
        description: 'Check-inÔºå‰ΩçÊñºÊñ∞Â∏ÇË°óÂïÜÂ∫óË°óÂÖß„ÄÇ',
        bookingCode: 'AGODA-8811'
      }
    ]
  },
  {
    date: '12/8',
    dayOfWeek: 'ÈÄ±‰∏Ä',
    weather: { temp: '11¬∞C', icon: 'sun' },
    items: [
      {
        id: '6-1',
        time: '10:00',
        title: 'ÁÜäÊú¨Âüé & ÂüéÂΩ©Ëãë',
        type: 'spot',
        location: 'ÁÜäÊú¨Âüé',
        description: 'ÂèÉËßÄ‰øÆÂæ©‰∏≠ÁöÑÁÜäÊú¨ÂüéÂ§©ÂÆàÈñ£ËàáÂüé‰∏ãÁî∫„ÄÇ',
        tips: ['üç¶ ÂøÖÂêÉÔºöÂüéÂΩ©ËãëÁöÑÊµ∑ËÜΩÂèØÊ®ÇÈ§Ö', 'üì∏ Â§©ÂÆàÈñ£È†ÇÊ®ìÈ¢®ÊôØ']
      },
      {
        id: '6-2',
        time: '12:30',
        title: 'ÁÜäÊú¨ÊãâÈ∫µ (ÂçàÈ§ê)',
        type: 'food',
        location: 'Èªë‰∫≠ÊãâÈ∫µ / Ê°ÇËä±ÊãâÈ∫µ',
        description: 'ÁâπËâ≤ÊòØÊøÉÈÉÅÁöÑÁÑ¶È¶ôËíúÊ≤π„ÄÇ',
      },
      {
        id: '6-3',
        time: '14:30',
        title: '‰∏ãÈÄö/‰∏äÈÄöÂïÜÂ∫óË°ó',
        type: 'spot',
        location: 'ÁÜäÊú¨‰∏ãÈÄöÂïÜÂ∫óË°ó',
        description: 'ÊúÄÂæåÊé°Ë≤∑‰º¥ÊâãÁ¶Æ„ÄÇ',
        tips: ['üõçÔ∏è ÂøÖÈÄõÔºöÈ∂¥Â±ãÁôæË≤®ÁÜäÊú¨ÁÜäÈÉ®Èï∑Ëæ¶ÂÖ¨ÂÆ§', 'üõçÔ∏è Ëó•Â¶ùÂ∫óÊØîÂÉπ']
      },
       {
        id: '6-4',
        time: '18:00',
        title: 'ÁÜäÊú¨È¶¨ËÇâÊñôÁêÜ (ÊôöÈ§ê)',
        type: 'food',
        location: 'ÁÆ°‰πÉÂ±ã / È¶¨Ê´ª',
        description: 'ÁÜäÊú¨ÂêçÁâ©ÁîüÈ¶¨ËÇâÈ´îÈ©ó„ÄÇ',
      }
    ]
  },
  {
    date: '12/9',
    dayOfWeek: 'ÈÄ±‰∫å',
    weather: { temp: '13¬∞C', icon: 'cloud' },
    items: [
      {
        id: '7-1',
        time: '09:00',
        title: 'ÂâçÂæÄÊ©üÂ†¥',
        type: 'transport',
        location: 'ÁÜäÊú¨Ê´ªÁî∫Â∑¥Â£´Á∏ΩÁ´ô',
        description: 'Êê≠‰πòÊ©üÂ†¥Â∑¥Â£´ÂâçÂæÄÁÜäÊú¨Ê©üÂ†¥„ÄÇ',
      },
      {
        id: '7-2',
        time: '11:45',
        title: 'ÊòüÂÆáËà™Á©∫ JX847',
        type: 'flight',
        location: 'ÁÜäÊú¨Ê©üÂ†¥ (KMJ)',
        description: 'È£õÂæÄÊ°ÉÂúí (TPE)ÔºåÈ†êË®à 13:25 ÊäµÈÅî„ÄÇ',
        bookingCode: 'REF: KYU-1209-STAR'
      },
      {
        id: '7-3',
        time: '15:43',
        title: 'Âè∞ÁÅ£È´òÈêµ',
        type: 'transport',
        location: 'È´òÈêµÊ°ÉÂúíÁ´ô',
        description: 'Êê≠‰πòÈ´òÈêµËøîÂõûÂè∞Âçó„ÄÇ',
      }
    ]
  }
];

// --- Components ---

const WeatherBadge = ({ temp, icon }: { temp: string; icon: 'sun' | 'rain' | 'cloud' }) => {
  const getIcon = () => {
    switch(icon) {
      case 'sun': return <Sun size={16} className="text-orange-500" />;
      case 'rain': return <CloudRain size={16} className="text-blue-500" />;
      default: return <Cloud size={16} className="text-gray-500" />;
    }
  };
  return (
    <div className="flex items-center gap-1 bg-white/80 backdrop-blur px-2 py-1 rounded-full text-xs font-medium shadow-sm border border-stone-200">
      {getIcon()}
      <span className="text-stone-700">{temp}</span>
    </div>
  );
};

const CategoryIcon = ({ type }: { type: string }) => {
  switch (type) {
    case 'flight': return <Plane size={18} className="text-sky-600" />;
    case 'transport': return <Train size={18} className="text-indigo-600" />;
    case 'food': return <Utensils size={18} className="text-orange-600" />;
    case 'hotel': return <Home size={18} className="text-emerald-600" />;
    case 'spot': return <Camera size={18} className="text-rose-600" />;
    default: return <MapPin size={18} className="text-gray-600" />;
  }
};

const DetailModal = ({ item, onClose }: { item: ItineraryItem; onClose: () => void }) => {
  if (!item) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-stone-900/60 backdrop-blur-sm animate-in fade-in duration-200">
      <div className="bg-[#fdfbf7] w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden border border-stone-200">
        <div className="p-4 border-b border-stone-200 flex justify-between items-center bg-white">
          <h3 className="font-bold text-stone-800 text-lg flex items-center gap-2">
            <CategoryIcon type={item.type} />
            {item.title}
          </h3>
          <button onClick={onClose} className="p-1 hover:bg-stone-100 rounded-full">
            <X size={20} className="text-stone-500" />
          </button>
        </div>
        
        <div className="p-5 space-y-4">
          <div className="space-y-1">
            <p className="text-xs font-bold text-stone-400 uppercase tracking-wider">TIME & LOCATION</p>
            <p className="text-stone-800 font-medium text-lg">{item.time}</p>
            <p className="text-stone-600">{item.location}</p>
          </div>

          {item.bookingCode && (
            <div className="bg-stone-100 p-3 rounded-lg border border-stone-200 dashed">
              <p className="text-xs text-stone-500 mb-1">È†êÁ¥Ñ/Ë®Ç‰Ωç‰ª£Ëôü</p>
              <p className="font-mono text-lg font-bold text-stone-800 tracking-wider">{item.bookingCode}</p>
            </div>
          )}

          {item.description && (
             <div className="space-y-1">
               <p className="text-xs font-bold text-stone-400 uppercase tracking-wider">DETAILS</p>
               <p className="text-stone-700 leading-relaxed text-sm">{item.description}</p>
             </div>
          )}
          
          {item.tips && item.tips.length > 0 && (
            <div className="bg-amber-50 p-3 rounded-lg border border-amber-100">
              <p className="text-xs font-bold text-amber-600 mb-2 flex items-center gap-1">
                <Info size={12} /> ÈÅî‰∫∫Á≠ÜË®ò
              </p>
              <ul className="space-y-1">
                {item.tips.map((tip, idx) => (
                  <li key={idx} className="text-xs text-amber-900 flex items-start gap-1">
                    <span>‚Ä¢</span>
                    <span>{tip}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}

          <a 
            href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.location)}`}
            target="_blank"
            rel="noopener noreferrer"
            className="flex items-center justify-center gap-2 w-full py-3 bg-stone-800 text-white rounded-xl hover:bg-stone-700 transition-colors font-medium shadow-lg shadow-stone-200"
          >
            <Navigation size={18} />
            ÈñãÂïü Google Maps Â∞éËà™
          </a>
        </div>
      </div>
    </div>
  );
};

const ToolsSection = () => {
  const [expenses, setExpenses] = useState<{item: string, price: number}[]>([
    { item: 'Á¶èÂ≤°ÂçàÈ§ê', price: 2500 },
    { item: '‰æøÂà©ÂïÜÂ∫ó', price: 800 }
  ]);
  const [newExpense, setNewExpense] = useState('');
  const [newPrice, setNewPrice] = useState('');

  const addExpense = () => {
    if (newExpense && newPrice) {
      setExpenses([...expenses, { item: newExpense, price: parseInt(newPrice) }]);
      setNewExpense('');
      setNewPrice('');
    }
  };

  const total = expenses.reduce((sum, curr) => sum + curr.price, 0);

  return (
    <div className="space-y-6 p-1 pb-20">
      <div className="bg-white rounded-xl p-4 shadow-sm border border-stone-100">
        <h3 className="font-bold text-stone-800 mb-3 flex items-center gap-2">
          <Phone size={18} className="text-rose-500" /> Á∑äÊÄ•ËÅØÁµ°
        </h3>
        <div className="space-y-3 text-sm">
          <div className="flex justify-between border-b border-stone-50 pb-2">
            <span className="text-stone-500">ÊïëË≠∑Ëªä/ÁÅ´Ë≠¶</span>
            <span className="font-mono font-bold text-rose-600">119</span>
          </div>
          <div className="flex justify-between border-b border-stone-50 pb-2">
            <span className="text-stone-500">Ë≠¶ÂØüÂ±Ä</span>
            <span className="font-mono font-bold text-rose-600">110</span>
          </div>
          <div className="flex justify-between">
            <span className="text-stone-500">Âè∞ÂåóÈßêÂ§ßÈò™Ëæ¶‰∫ãËôïÁ¶èÂ≤°ÂàÜËôï</span>
            <span className="font-mono font-bold text-stone-800">092-734-2810</span>
          </div>
        </div>
      </div>

      <div className="bg-white rounded-xl p-4 shadow-sm border border-stone-100">
        <h3 className="font-bold text-stone-800 mb-3 flex items-center gap-2">
          <Briefcase size={18} className="text-indigo-500" /> Ëà™Áè≠Ë≥áË®ä
        </h3>
        <div className="bg-indigo-50 rounded-lg p-3 mb-2">
          <div className="flex justify-between text-xs text-indigo-400 mb-1">12/03 ÂéªÁ®ã</div>
          <div className="font-bold text-indigo-900">JX 846 TPE - KMJ</div>
          <div className="text-sm text-indigo-700">07:30 - 10:30</div>
        </div>
        <div className="bg-indigo-50 rounded-lg p-3">
          <div className="flex justify-between text-xs text-indigo-400 mb-1">12/09 ÂõûÁ®ã</div>
          <div className="font-bold text-indigo-900">JX 847 KMJ - TPE</div>
          <div className="text-sm text-indigo-700">11:45 - 13:25</div>
        </div>
      </div>

      <div className="bg-white rounded-xl p-4 shadow-sm border border-stone-100">
        <h3 className="font-bold text-stone-800 mb-3 flex items-center gap-2">
          <CreditCard size={18} className="text-emerald-500" /> Ë®òÂ∏≥Â∞èÂπ´Êâã (JPY)
        </h3>
        <div className="flex gap-2 mb-4">
          <input 
            type="text" 
            placeholder="È†ÖÁõÆ" 
            className="flex-1 bg-stone-50 border border-stone-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-stone-400"
            value={newExpense}
            onChange={(e) => setNewExpense(e.target.value)}
          />
          <input 
            type="number" 
            placeholder="¬•" 
            className="w-20 bg-stone-50 border border-stone-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-stone-400"
            value={newPrice}
            onChange={(e) => setNewPrice(e.target.value)}
          />
          <button 
            onClick={addExpense}
            className="bg-stone-800 text-white px-3 rounded-lg text-sm font-medium"
          >
            +
          </button>
        </div>
        <div className="space-y-2 max-h-40 overflow-y-auto">
          {expenses.map((ex, i) => (
            <div key={i} className="flex justify-between text-sm text-stone-600">
              <span>{ex.item}</span>
              <span className="font-mono">¬•{ex.price}</span>
            </div>
          ))}
        </div>
        <div className="mt-3 pt-3 border-t border-stone-100 flex justify-between font-bold text-stone-800">
          <span>Total</span>
          <span className="font-mono text-emerald-600">¬•{total}</span>
        </div>
      </div>
    </div>
  );
};

export default function KyushuTravelLog() {
  const [activeTab, setActiveTab] = useState<'itinerary' | 'tools'>('itinerary');
  const [selectedDayIndex, setSelectedDayIndex] = useState(0);
  const [selectedItem, setSelectedItem] = useState<ItineraryItem | null>(null);

  const currentDay = itineraryData[selectedDayIndex];

  return (
    <div className="min-h-screen bg-[#f5f2eb] font-sans text-stone-800 flex flex-col items-center">
      {/* Container for mobile-first simulation */}
      <div className="w-full max-w-md bg-[#fdfbf7] min-h-screen shadow-2xl relative flex flex-col">
        
        {/* Header */}
        <header className="sticky top-0 z-10 bg-[#fdfbf7]/90 backdrop-blur-md border-b border-stone-200 px-5 py-4 flex justify-between items-end">
          <div>
            <p className="text-xs font-bold text-stone-400 tracking-widest uppercase mb-1">JAPAN TRIP 2024</p>
            <h1 className="text-2xl font-bold text-stone-800 font-serif">‰πùÂ∑ûÊóÖÂ∏ñ</h1>
          </div>
          {activeTab === 'itinerary' && (
            <div className="text-right">
              <WeatherBadge temp={currentDay.weather.temp} icon={currentDay.weather.icon} />
            </div>
          )}
        </header>

        {/* Content Area */}
        <main className="flex-1 overflow-y-auto scrollbar-hide">
          
          {activeTab === 'itinerary' ? (
            <>
              {/* Date Selector */}
              <div className="sticky top-[73px] z-10 bg-[#fdfbf7] py-2 border-b border-stone-100 shadow-sm">
                <div className="flex overflow-x-auto px-4 gap-3 pb-2 scrollbar-hide snap-x">
                  {itineraryData.map((day, idx) => (
                    <button
                      key={day.date}
                      onClick={() => setSelectedDayIndex(idx)}
                      className={`flex-shrink-0 snap-center flex flex-col items-center justify-center w-14 h-16 rounded-xl transition-all duration-300 ${
                        selectedDayIndex === idx 
                          ? 'bg-stone-800 text-white shadow-lg scale-105' 
                          : 'bg-white text-stone-400 border border-stone-100'
                      }`}
                    >
                      <span className="text-xs font-medium">{day.date}</span>
                      <span className={`text-sm font-bold ${selectedDayIndex === idx ? 'text-stone-200' : 'text-stone-600'}`}>
                        {day.dayOfWeek}
                      </span>
                    </button>
                  ))}
                </div>
              </div>

              {/* Timeline Items */}
              <div className="p-5 pb-24 space-y-6">
                {currentDay.items.map((item, idx) => (
                  <div key={item.id} className="relative pl-6 group">
                    {/* Timeline Line */}
                    {idx !== currentDay.items.length - 1 && (
                      <div className="absolute left-[11px] top-8 bottom-[-24px] w-[2px] bg-stone-200" />
                    )}
                    
                    {/* Timeline Dot */}
                    <div className={`absolute left-0 top-1.5 w-6 h-6 rounded-full border-4 border-[#fdfbf7] flex items-center justify-center
                      ${item.type === 'transport' ? 'bg-indigo-500' : 
                        item.type === 'food' ? 'bg-orange-500' : 
                        item.type === 'spot' ? 'bg-rose-500' : 
                        item.type === 'flight' ? 'bg-sky-500' : 'bg-emerald-500'}`}
                    >
                    </div>

                    {/* Card */}
                    <div 
                      onClick={() => setSelectedItem(item)}
                      className="bg-white rounded-xl p-4 shadow-sm border border-stone-100 active:scale-98 transition-transform cursor-pointer hover:shadow-md"
                    >
                      <div className="flex justify-between items-start mb-2">
                        <span className="text-xs font-mono font-bold text-stone-400 bg-stone-50 px-2 py-0.5 rounded">
                          {item.time}
                        </span>
                        {item.bookingCode && (
                          <span className="text-[10px] font-bold text-emerald-600 bg-emerald-50 px-1.5 py-0.5 rounded border border-emerald-100">
                            Â∑≤È†êÁ¥Ñ
                          </span>
                        )}
                      </div>
                      
                      <div className="flex gap-3">
                        <div className="flex-1">
                          <h3 className="font-bold text-stone-800 text-base mb-1">{item.title}</h3>
                          <p className="text-xs text-stone-500 line-clamp-1 mb-2">{item.location}</p>
                          
                          {/* Mini Tags */}
                          {item.tips && (
                             <div className="flex flex-wrap gap-1 mt-2">
                               {item.tips.slice(0, 2).map((tip, i) => (
                                 <span key={i} className="text-[10px] bg-amber-50 text-amber-700 px-1.5 py-0.5 rounded border border-amber-100">
                                   {tip}
                                 </span>
                               ))}
                             </div>
                          )}
                        </div>
                        <div className="flex flex-col items-center justify-center pl-2 border-l border-stone-100 text-stone-300">
                          <ChevronRight size={20} />
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </>
          ) : (
            <div className="p-5">
              <ToolsSection />
            </div>
          )}
        </main>

        {/* Bottom Tab Bar */}
        <nav className="sticky bottom-0 bg-white border-t border-stone-200 px-6 py-3 flex justify-around pb-6 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
          <button 
            onClick={() => setActiveTab('itinerary')}
            className={`flex flex-col items-center gap-1 transition-colors ${activeTab === 'itinerary' ? 'text-stone-800' : 'text-stone-400'}`}
          >
            <Calendar size={24} strokeWidth={activeTab === 'itinerary' ? 2.5 : 2} />
            <span className="text-[10px] font-medium">Ë°åÁ®ã</span>
          </button>
          
          <div className="w-px h-8 bg-stone-200 mx-2 self-center"></div>

          <button 
            onClick={() => setActiveTab('tools')}
            className={`flex flex-col items-center gap-1 transition-colors ${activeTab === 'tools' ? 'text-stone-800' : 'text-stone-400'}`}
          >
            <Briefcase size={24} strokeWidth={activeTab === 'tools' ? 2.5 : 2} />
            <span className="text-[10px] font-medium">Â∑•ÂÖ∑ÁÆ±</span>
          </button>
        </nav>

        {/* Modal */}
        {selectedItem && (
          <DetailModal item={selectedItem} onClose={() => setSelectedItem(null)} />
        )}

      </div>
    </div>
  );
}